<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>智慧工地管控平台</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <link rel="stylesheet" href="/static/layui/css/layui.css">
  <link rel="stylesheet" href="/static/font-awesome/css/font-awesome.min.css"> 
  <link rel="stylesheet" href="/static/css/animate.css">
  <link rel="stylesheet" href="/static/css/x-admin.css">
  <link rel="stylesheet" href="/static/css/layui-icon-extend/iconfont.css">
</head>
<body style="height: 100%; overflow: hidden;">
              
<div class="layui-layout layui-layout-admin">
  <!--顶部菜单栏-->
    {% include "common/head.html" %}
  <!--侧边菜单栏-->
    {% include "common/sidebar.html" %}
</div>


  <!--顶部数据分析栏-->
<div class="layui-tab layui-tab-brief" lay-filter="tabMain" lay-allowclose="true" style="padding-left: 217px">
  <ul class="layui-tab-title">
    <li class="layui-this" lay-id="home" ><i class="fa fa-home" aria-hidden="true"></i> 首页<i class="layui-icon layui-unselect layui-tab-close" style="display: none;"></i></li>
  </ul>
  <div class="layui-tab-content">
    <div id="box" class="layui-tab-item layui-show" style="overflow-y: auto; height: max-content">
        {% include "content/mainanalyse/mainanalyse.html" %}
    </div>
  </div>
</div>

<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script src="/static/js/jquery-3.3.1.min.js"></script>
<script src="/static/js/list.js"></script> 
<script src="/static/js/echarts.js"></script>
<script src="/static/js/echarts-gl.js"></script>
<script src="/static/layui/layui.js"></script>

{% include "content/mainanalyse/jsfile.html" %}

<script>
    $(document).ready(function(){
        var height = $(window).height();   // 浏览器的高度
        $("#box").height(height-130);      // 浏览器的高度加在类名为box的DIV 上
    });
</script>

<script>
    layui.use(['element','layer','laydate','carousel'], function(){
        var 
            $ = layui.jquery
            ,element = layui.element //Tab的切换功能，切换事件监听等，需要依赖element模块
            ,layer = layui.layer
            ,laydate = layui.laydate
            ,carousel = layui.carousel;

        //日期时间范围
        laydate.render({
            elem: '#dtSearch'
            ,range: true
        });

        carousel.render({
            elem: '#worker'
            ,width: '100%' //设置容器宽度
            ,height: '100px'
            ,arrow: 'none'
            ,indicator: 'outside'
        });

        carousel.render({
            elem: '#cargroup'
            ,width: '100%' //设置容器宽度
            ,height: '100px'
            ,arrow: 'none'
            ,indicator: 'outside'
        });

        carousel.render({
            elem: '#carpersonel'
            ,width: '100%' //设置容器宽度
            ,height: '100px'
            ,arrow: 'none'
            ,indicator: 'outside'
        });

        carousel.render({
            elem: '#auth'
            ,width: '100%' //设置容器宽度
            ,height: '100px'
            ,arrow: 'none'
            ,indicator: 'outside'
        });

        carousel.render({
            elem: '#rxtongdao'
            ,width: '100%' //设置容器宽度
            ,height: '90px'
            ,arrow: 'none'
            ,indicator: 'outside'
            ,autoplay: false
        });

        carousel.render({
            elem: '#cxtongdao'
            ,width: '100%' //设置容器宽度
            ,height: '90px'
            ,arrow: 'none'
            ,indicator: 'outside'
            ,autoplay: false
        });

        carousel.render({
            elem: '#tdliuliang'
            ,width: '100%' //设置容器宽度
            ,height: '336px'
            ,arrow: 'none'
            ,indicator: 'outside'
            ,autoplay: false
        });

        carousel.render({
            elem: '#pltxdt'
            ,width: '100%' //设置容器宽度
            ,height: '141px'
            ,arrow: 'none'
            ,indicator: 'outside'
            ,autoplay: false
        });


        carousel.on('change(test1)', function(obj){
            if (obj.index == 1) {
                $.ajax({
                    type: 'POST',
                    url: "{% url 'mainanalyse:vehpassageanalyse' %}",
                    data: {},
                    datatype: "JSON",
                    success: function (data) {
                        var dom = document.getElementById("drawvehpassage");
                        var myChart1 = echarts.init(dom);
                        var objDate = data.FDay;
                        var objRkvalue = data.FRkvalue;
                        var objCkvalue = data.FCkvalue;

                        option = {
                            title: {
                                text: '车行通道吞吐量分析',
                                subtext: ''
                            },

                            angleAxis: [{
                                type: "value",
                                minInterval: 1
                            }],
                            radiusAxis: {
                                show: true,
                                type: 'category',
                                data: objDate,
                                z: 10
                            },
                            polar: {
                            },
                            series: [{
                                type: 'bar',
                                data: objRkvalue,
                                coordinateSystem: 'polar',
                                name: '入口流量',
                                stack: 'a'
                            }, {
                                type: 'bar',
                                data: objCkvalue,
                                coordinateSystem: 'polar',
                                name: '出口流量',
                                stack: 'a'
                            }],

                            tooltip: {
                                trigger: 'axis',
                                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                                }
                            },

                            legend: {
                                show: true,
                                top: "bottom",
                                left: "left",
                                data: ['入口流量','出口流量']
                            }
                        };
                        myChart1.setOption(option, true);
                        myChart1.resize();
                    }
                });
            }
        });


        arry = new ArrayList();

        function tabAdd(title,id,url)
        {
            //判断tab是否存在
            if(arry.find(id).value!=id){
                element.tabAdd('tabMain', {
                    title: title //用于演示
                    ,content:"<iframe id='"+id+"' src='"+ url
                    + "' frameborder='0' width='1050' height='1900'></iframe>"
                    ,id:id
                });

                var ifm= document.getElementById(id);
                ifm.height=document.documentElement.clientHeight-130;
                ifm.width=document.documentElement.clientWidth-230;

                arry.append(id);
            }
            //切换tab
            element.tabChange('tabMain',id);
        }

        element.on('tabDelete', function(data){
            arry.removeAt(data.index-1);
        });

        element.on('nav(navTop)', function (elem) {
            var $a = $(elem);
            var data = {
                id : $a.attr('data-id'),
                url: $a.attr('data-url'),
                title : elem.children("span").text()
            };
           
            tabAdd(data.title, data.id, 'show?url='+data.url)
        });

        element.on('nav(navSidebar)', function (elem) {
            var $a = $(elem);
            var data = {
                id : $a.attr('data-id'),
                url: $a.attr('data-url'),
                title : elem.children("span").text()
            };

            tabAdd(data.title, data.id, 'show?url='+data.url)
        });


            $("a[name='prj_click']").click(function(){
                window.top.layer.open({
                    type: 2,
                    title: '切换项目',
                    fixed: false,
                    resize: false,
                    move: false,
                    area: ['900px', '500px'],
                    content: "{% url 'login:login_showPrj' %}?orgid={{ request.session.UserOrg }}"
                });
            });


    });
</script>


</body>
</html>
